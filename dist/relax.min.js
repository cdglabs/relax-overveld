!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Relax=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){function Constraint(){}Constraint.prototype.involvesPoint=function(p){var self=this;return Object.keys(this).map(function(key){return self[key]===p}).reduce(function(a,b){return a||b})};module.exports=Constraint},{}],2:[function(_dereq_,module,exports){function square(x){return x*x}function Point(x,y){this.x=x;this.y=y}Point.prototype.plus=function(that){return new Point(this.x+that.x,this.y+that.y)};Point.prototype.minus=function(that){return new Point(this.x-that.x,this.y-that.y)};Point.prototype.negated=function(){return this.scaledBy(-1)};Point.prototype.clone=function(){return this.scaledBy(1)};Point.prototype.clearDelta=function(){if(this.delta){this.delta.x=this.delta.y=0}else{this.delta=new Point(0,0)}};Point.prototype.addDelta=function(d){this.delta.x+=d.x;this.delta.y+=d.y};Point.prototype.scaledBy=function(n){return new Point(this.x*n,this.y*n)};Point.prototype.magnitude=function(){return Math.sqrt(square(this.x)+square(this.y))};Point.prototype.normalized=function(){return this.scaledBy(1/this.magnitude())};Point.prototype.rotatedBy=function(dTheta){var theta=Math.atan2(this.y,this.x)+dTheta;var mag=this.magnitude();return new Point(mag*Math.cos(theta),mag*Math.sin(theta))};module.exports=Point},{}],3:[function(_dereq_,module,exports){Point=_dereq_("./Point.js");function installBuiltInConstraints(Relax){Relax.declareConstraintType("coordinate",function(p,x,y){this.p=p;this.c=new Point(x,y)},function(){this.p.addDelta(this.c.minus(this.p))});Relax.declareConstraintType("coincidence",function(p1,p2){this.p1=p1;this.p2=p2},function(){var d=this.p2.minus(this.p1).scaledBy(.5);this.p1.addDelta(d);this.p2.addDelta(d.negated())});Relax.declareConstraintType("equivalence",function(p1,p2,p3,p4){this.p1=p1;this.p2=p2;this.p3=p3;this.p4=p4},function(){var d1=this.p2.plus(this.p3).minus(this.p4).minus(this.p1).scaledBy(.25);this.p1.addDelta(d1);this.p4.addDelta(d1);var d2=this.p1.plus(this.p4).minus(this.p2).minus(this.p3).scaledBy(.25);this.p2.addDelta(d2);this.p3.addDelta(d2)});Relax.declareConstraintType("eqdist",function(p1,p2,p3,p4){this.p1=p1;this.p2=p2;this.p3=p3;this.p4=p4},function(){var l12=this.p1.minus(this.p2).magnitude();var l34=this.p3.minus(this.p4).magnitude();var delta=(l12-l34)/4;var e12=this.p2.minus(this.p1).normalized();var e34=this.p4.minus(this.p3).normalized();this.p1.addDelta(e12.scaledBy(delta));this.p2.addDelta(e12.scaledBy(-delta));this.p3.addDelta(e34.scaledBy(-delta));this.p4.addDelta(e34.scaledBy(delta))});Relax.declareConstraintType("length",function(p1,p2,l){this.p1=p1;this.p2=p2;this.l=l},function(){var l12=this.p1.minus(this.p2).magnitude();var delta=(l12-this.l)/2;var e12=this.p2.minus(this.p1).normalized();var d=e12.scaledBy(delta);this.p1.addDelta(d);this.p2.addDelta(d.negated())});Relax.declareConstraintType("orientation",function(p1,p2,p3,p4,theta){this.p1=p1;this.p2=p2;this.p3=p3;this.p4=p4;this.theta=theta},function(){var v12=this.p2.minus(this.p1);var a12=Math.atan2(v12.y,v12.x);var m12=this.p1.plus(this.p2).scaledBy(.5);var v34=this.p4.minus(this.p3);var a34=Math.atan2(v34.y,v34.x);var m34=this.p3.plus(this.p4).scaledBy(.5);var currTheta=a12-a34;var dTheta=this.theta-currTheta;this.p1.addDelta(m12.plus(this.p1.minus(m12).rotatedBy(dTheta)).minus(this.p1));this.p2.addDelta(m12.plus(this.p2.minus(m12).rotatedBy(dTheta)).minus(this.p2));this.p3.addDelta(m34.plus(this.p3.minus(m34).rotatedBy(-dTheta)).minus(this.p3));this.p4.addDelta(m34.plus(this.p4.minus(m34).rotatedBy(-dTheta)).minus(this.p4))});Relax.declareConstraintType("motor",function(p1,p2,w){this.p1=p1;this.p2=p2;this.w=w;this.lastT=Date.now()},function(now){var t=now-this.lastT;var dTheta=t*this.w*2*Math.PI/1e3;var m12=this.p1.plus(this.p2).scaledBy(.5);this.p1.addDelta(m12.plus(this.p1.minus(m12).rotatedBy(dTheta)).minus(this.p1));this.p2.addDelta(m12.plus(this.p2.minus(m12).rotatedBy(dTheta)).minus(this.p2));this.lastT=now})}module.exports=installBuiltInConstraints},{"./Point.js":2}],4:[function(_dereq_,module,exports){var Point=_dereq_("./Point.js");var Constraint=_dereq_("./Constraint.js");var installBuiltInConstraints=_dereq_("./installBuiltInConstraints.js");function Relax(){this.rho=.25;this.epsilon=.001;this.points=[];this.constraints=[]}var constraintTypes={};Relax.declareConstraintType=function(name,ctor,addDeltasFn){constraintTypes[name]=ctor;ctor.prototype=new Constraint;ctor.prototype.addDeltas=addDeltasFn};Relax.getConstraintType=function(name){if(constraintTypes[name]){return constraintTypes[name]}else{throw"unknown constraint type "+name}};installBuiltInConstraints(Relax);Relax.prototype.addPoint=function(x,y){var p=new Point(x,y);this.points.push(p);return p};Relax.prototype.removePoint=function(unwanted){this.points=this.points.filter(function(p){return p!==unwanted});this.constraints=this.constraints.filter(function(c){return!c.involvesPoint(unwanted)})};Relax.prototype.addConstraint=function(type){var ctor=Relax.getConstraintType(type);var args=Array.prototype.slice.call(arguments);if(args.length-1!==ctor.length){throw["wrong number of arguments to ",type," constructor ","(expected ",ctor.length," but got ",args.length-1,")"].join("")}var noArgCtor=ctor.bind.apply(ctor,args);var c=new noArgCtor;this.constraints.push(c);return c};Relax.prototype.removeConstraint=function(unwanted){this.constraints=this.constraints.filter(function(c){return c!==unwanted})};Relax.prototype.doOneIteration=function(t){if(this.beforeEachIteration){this.beforeEachIteration()}var self=this;this.points.forEach(function(p){p.clearDelta()});this.constraints.forEach(function(c){c.addDeltas(t)});var didSomething=false;this.points.forEach(function(p){didSomething|=p.delta.x>self.epsilon||p.delta.y>self.epsilon});if(didSomething){this.points.forEach(function(p){p.x+=self.rho*p.delta.x;p.y+=self.rho*p.delta.y});return true}else{return false}};Relax.prototype.iterateForUpToMillis=function(tMillis){var count=0;var now,t0,t;var didSomething=true;now=t0=Date.now();t=0;while(t<tMillis&&didSomething){didSomething=this.doOneIteration(now);now=Date.now();t=now-t0;if(didSomething){count++}}return count};module.exports=Relax},{"./Constraint.js":1,"./Point.js":2,"./installBuiltInConstraints.js":3}]},{},[4])(4)});